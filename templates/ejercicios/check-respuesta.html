{% extends "base.html" %}
{% block content %}
<header>
    <div class="exit-button">
      <title>{% block title %}Feedback{% endblock %}</title>
      <a href="{% url 'mainPage' %}"><- Salir  </a>
    </div>
<h1>Resultado</h1>

<div class="result">
  <h2>Ejercicio: {{ ejercicio.enunciado }}</h2>
  <p>Tu respuesta: <strong>{{ intento.respuesta_estudiante }}</strong></p>
  <p>Resultado: 
    {% if es_correcto %}
      <span class="badge badge-success">Correcto ✓</span>
    {% else %}
      <span class="badge badge-danger">Incorrecto ✗</span>
    {% endif %}
    (Puntos: {{ puntos }})
  </p>
</div>

<hr>
  <h4>Explicación / solución sugerida por IA</h4>
  {% if feedback %}
    <pre style="white-space:pre-wrap;">{{ feedback.contexto_ejercicio }}</pre>
    <h5>Corrección estructurada</h5>
    <pre>{{ feedback.feedback|json_script:"fbjson" }}</pre>
  {% else %}
    <p>No hay feedback IA disponible.</p>
  {% endif %}

<div class="cols">
  <section class="student-steps">
    <h3>Tus pasos</h3>
    {% if pasos_intento %}
      <ol>
        {% for p in pasos_intento %}
          <li><pre>{{ p.contenido }}</pre></li>
        {% endfor %}
      </ol>
    {% else %}
      <p>No ingresaste pasos. Lo cual es raro porque debería haber al menos un paso, avisar a Administración</p>
    {% endif %}
  </section>

  <section class="correct-steps">
    <h3>Pasos correctos (solución almacenada)</h3>
    {% if pasos_correctos %}
      <ol>
        {% for p in pasos_correctos %}
          <li><pre>{{ p.contenido }}</pre></li>
        {% endfor %}
      </ol>
    {% else %}
      <p>No hay pasos correctos guardados para este ejercicio.</p>
    {% endif %}
  </section>
</div>

{% if feedback %}
  <hr>
  <section class="feedback">
    <h3>Feedback ({{ feedback.fuente_ia }})</h3>
    <p>{{ feedback.feedback }}</p>
    {% if feedback_pasos %}
      <h4>Feedback por pasos</h4>
      <ol>
        {% for fp in feedback_pasos %}
          <li>[{{ fp.tipo_feedback.nombre }}] <pre>{{ fp.contenido }}</pre></li>
        {% endfor %}
      </ol>
    {% endif %}
  </section>
{% endif %}

<hr>

{% endblock %}
